# Ïû¨ÏûÖÍ≥† ÏïåÎ¶º ÏãúÏä§ÌÖú

## ÌîÑÎ°úÏ†ùÌä∏ ÏÜåÍ∞ú
Í≥ºÏ†ú Ïû¨ÏûÖÍ≥† ÏïåÎ¶º ÏãúÏä§ÌÖúÏùÄ ÏÉÅÌíàÏù¥ Ïû¨ÏûÖÍ≥† ÎêòÏóàÏùÑ Îïå, Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌïú Ïú†Ï†ÄÎì§ÏóêÍ≤å Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ Î≥¥ÎÇ¥Ï§çÎãàÎã§.

---

## Í∏∞Ïà† Ïä§ÌÉù
- **Ïñ∏Ïñ¥**: Java, Spring Boot
- **DB**: MySQL
- **ÎπåÎìú ÎèÑÍµ¨**: Gradle
- **ÌÖåÏä§Ìä∏**: JUnit5

---

## ÎπÑÏ¶àÎãàÏä§ ÏöîÍµ¨ ÏÇ¨Ìï≠
- Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ Ï†ÑÏÜ°ÌïòÍ∏∞ Ï†Ñ, ÏÉÅÌíàÏùò Ïû¨ÏûÖÍ≥† ÌöåÏ∞®Î•º 1 Ï¶ùÍ∞Ä ÏãúÌÇ®Îã§.
  - Ïã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî Îã§Î•∏ ÌòïÌÉúÎ°ú Í¥ÄÎ¶¨ÌïòÏßÄÎßå, Í≥ºÏ†úÏóêÏÑúÎäî ÏßÅÏ†ë Í¥ÄÎ¶¨ÌïúÎã§.
- ÏÉÅÌíàÏù¥ Ïû¨ÏûÖÍ≥† ÎêòÏóàÏùÑ Îïå, Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌïú Ïú†Ï†ÄÎì§ÏóêÍ≤å ÏïåÎ¶º Î©îÏãúÏßÄÎ•º Ï†ÑÎã¨Ìï¥Ïïº ÌïúÎã§.
  - ProductUserNotification ÌÖåÏù¥Î∏îÏóê Ï°¥Ïû¨ÌïòÎäî Ïú†Ï†ÄÎäî Î™®Îëê Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌñàÎã§Í≥† Í∞ÄÏ†ïÌïúÎã§.
- Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÄ Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌïú Ïú†Ï†Ä ÏàúÏÑúÎåÄÎ°ú Î©îÏãúÏßÄÎ•º Ï†ÑÏÜ°ÌïúÎã§.
- ÌöåÏ∞®Î≥Ñ Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ Î∞õÏùÄ Ïú†Ï†Ä Î™©Î°ùÏùÑ Ï†ÄÏû•Ìï¥Ïïº ÌïúÎã§.
- Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ Î≥¥ÎÇ¥Îçò Ï§ë Ïû¨Í≥†Í∞Ä Î™®Îëê ÏóÜÏñ¥ÏßÑÎã§Î©¥ ÏïåÎ¶º Î≥¥ÎÇ¥Îäî Í≤ÉÏùÑ Ï§ëÎã®Ìï©ÎãàÎã§.
- Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ°Ïùò ÏÉÅÌÉúÎ•º DB Ïóê Ï†ÄÏû•Ìï¥Ïïº ÌïúÎã§.
  - IN_PROGRESS (Î∞úÏÜ° Ï§ë)
  - CANCELED_BY_SOLD_OUT (ÌíàÏ†àÏóê ÏùòÌïú Î∞úÏÜ° Ï§ëÎã®)
  - CANCELED_BY_ERROR (ÏòàÏô∏Ïóê ÏùòÌïú Î∞úÏÜ° Ï§ëÎã®)
    - ÏÑúÎìú ÌååÌã∞ Ïó∞ÎèôÏóêÏÑúÏùò ÏòàÏô∏ Î•º ÏùòÎØ∏ÌïúÎã§.
  - COMPLETED (ÏôÑÎ£å)

---

## **Í∏∞Ïà†Ï†Å ÏöîÍµ¨ ÏÇ¨Ìï≠**
- ÏïåÎ¶º Î©îÏãúÏßÄÎäî 1Ï¥àÏóê ÏµúÎåÄ 500Í∞úÏùò ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇº Ïàò ÏûàÎã§.
    - ÏÑúÎìú ÌååÌã∞ Ïó∞ÎèôÏùÑ ÌïòÏßÑ ÏïäÍ≥†, ProductNotificationHistory ÌÖåÏù¥Î∏îÏóê Îç∞Ïù¥ÌÑ∞Î•º Ï†ÄÏû•ÌïúÎã§.
- Mysql Ï°∞Ìöå Ïãú, Ïù∏Îç±Ïä§Î•º Ïûò ÌÉà Ïàò ÏûàÍ≤å ÏÑ§Í≥ÑÌï¥Ïïº Ìï©ÎãàÎã§.
- ÏÑ§Í≥ÑÌï¥Ïïº Ìï† ÌÖåÏù¥Î∏î Î™©Î°ù
    1. Product (ÏÉÅÌíà)
        1. ÏÉÅÌíà ÏïÑÏù¥Îîî
        2. Ïû¨ÏûÖÍ≥† ÌöåÏ∞®
        3. Ïû¨Í≥† ÏÉÅÌÉú
    2. ProductNotificationHistory (ÏÉÅÌíàÎ≥Ñ Ïû¨ÏûÖÍ≥† ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨)
        1. ÏÉÅÌíà ÏïÑÏù¥Îîî
        2. Ïû¨ÏûÖÍ≥† ÌöåÏ∞®
        3. Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Î∞úÏÜ° ÏÉÅÌÉú
        4. ÎßàÏßÄÎßâ Î∞úÏÜ° Ïú†Ï†Ä ÏïÑÏù¥Îîî
    3. ProductUserNotification (ÏÉÅÌíàÎ≥Ñ Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌïú Ïú†Ï†Ä)
        1. ÏÉÅÌíà ÏïÑÏù¥Îîî
        2. Ïú†Ï†Ä ÏïÑÏù¥Îîî
        3. ÌôúÏÑ±Ìôî Ïó¨Î∂Ä
        4. ÏÉùÏÑ± ÎÇ†Ïßú
        5. ÏàòÏ†ï ÎÇ†Ïßú
    4. ProductUserNotificationHistory (ÏÉÅÌíà + Ïú†Ï†ÄÎ≥Ñ ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨)
        1. ÏÉÅÌíà ÏïÑÏù¥Îîî
        2. Ïú†Ï†Ä ÏïÑÏù¥Îîî
        3. Ïû¨ÏûÖÍ≥† ÌöåÏ∞®
        4. Î∞úÏÜ° ÎÇ†Ïßú
- (Optional) ÏòàÏô∏Ïóê ÏùòÌï¥ ÏïåÎ¶º Î©îÏãúÏßÄ Î∞úÏÜ°Ïù¥ Ïã§Ìå®Ìïú Í≤ΩÏö∞, manual ÌïòÍ≤å ÏÉÅÌíà Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Î©îÏãúÏßÄÎ•º Îã§Ïãú Î≥¥ÎÇ¥Îäî APIÎ•º Ìò∏Ï∂úÌïúÎã§Î©¥ ÎßàÏßÄÎßâÏúºÎ°ú Ï†ÑÏÜ° ÏÑ±Í≥µÌïú Ïù¥ÌõÑ Ïú†Ï†ÄÎ∂ÄÌÑ∞ Îã§Ïãú ÏïåÎ¶º Î©îÏãúÏßÄÎ•º Î≥¥ÎÇº Ïàò ÏûàÏñ¥Ïïº ÌïúÎã§.
    - 10Î≤àÏß∏ Ïú†Ï†ÄÍπåÏßÄ ÏïåÎ¶º Î©îÏãúÏßÄ Ï†ÑÏÜ°Ïóê ÏÑ±Í≥µÌñàÎã§Î©¥, Îã§Ïùå ÏöîÏ≤≠ÏóêÏÑú 11Î≤àÏß∏ Ïú†Ï†ÄÎ∂ÄÌÑ∞ ÏïåÎ¶º Î©îÏãúÏßÄÎ•º Ï†ÑÏÜ°Ìï† Ïàò ÏûàÏñ¥Ïïº ÌïúÎã§.
- ÏãúÏä§ÌÖú Íµ¨Ï°∞ ÏÉÅ ÎπÑÎèôÍ∏∞Î°ú Ï≤òÎ¶¨ ÎêòÏñ¥Ïïº ÌïòÎäî Î∂ÄÎ∂ÑÏùÄ Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäîÎã§Í≥† Í∞ÄÏ†ïÌï©ÎãàÎã§.
- (Optional) ÌÖåÏä§Ìä∏ ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎ©¥ Ï¢ãÏäµÎãàÎã§.

---

## üîß ÌîÑÎ°úÏ†ùÌä∏ Íµ¨Ï°∞
    src/ 
      ‚îú‚îÄ‚îÄ docker/ # Docker Í¥ÄÎ†® ÏÑ§Ï†ï 
      ‚îú‚îÄ‚îÄ main/ 
      ‚îÇ ‚îú‚îÄ‚îÄ java/com/example/restocknotificationsysyem/ ‚îÇ 
      ‚îÇ ‚îú‚îÄ‚îÄ domain/ # ÎèÑÎ©îÏù∏ Í¥ÄÎ†® Í≥ÑÏ∏µ ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ controller/ # Ïª®Ìä∏Î°§Îü¨ Í≥ÑÏ∏µ ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ dto/ # Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° Í∞ùÏ≤¥ (DTO) ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ entity/ # ÏóîÌã∞Ìã∞ ÌÅ¥ÎûòÏä§ ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ repository/ # Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ëÍ∑º Í≥ÑÏ∏µ ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ service/ # ÏÑúÎπÑÏä§ Î°úÏßÅ Í≥ÑÏ∏µ ‚îÇ 
      ‚îÇ ‚îú‚îÄ‚îÄ global/ # Ï†ÑÏó≠ ÏÑ§Ï†ï Î∞è Í¥ÄÎ¶¨ ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ exception/ # ÏòàÏô∏ Ï≤òÎ¶¨ ‚îÇ 
      ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ message/ # Î©îÏãúÏßÄ Í¥ÄÎ¶¨ ‚îÇ 
      ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ scheduler/ # Ïä§ÏºÄÏ§ÑÎü¨ Í¥ÄÎ†® ‚îÇ 
      ‚îÇ ‚îî‚îÄ‚îÄ RestockNotificationSysyemApplication # Î©îÏù∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò Ïã§Ìñâ ÌååÏùº
      ‚îÇ ‚îî‚îÄ‚îÄ resources/ ‚îÇ 
      ‚îú‚îÄ‚îÄ application.properties # Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏÑ§Ï†ï ÌååÏùº 
      ‚îî‚îÄ‚îÄ test/ 
      ‚îî‚îÄ‚îÄ java/com/example/restocknotificationsysyem/ 
      ‚îî‚îÄ‚îÄ domain/service/ # ÏÑúÎπÑÏä§ Í≥ÑÏ∏µ ÌÖåÏä§Ìä∏
---
## ÏÑ§Ïπò Î∞è Ïã§Ìñâ Î∞©Î≤ï

**1. ÌîÑÎ°úÏ†ùÌä∏ ÌÅ¥Î°†**  
```bash
git clone git@github.com:HwiyoungJeon/restocknotificationSystem.git
cd reviceservice
```
**2. Docker Compose ÏÑ§Ïπò**  
```bash
sudo apt update
sudo apt install docker.io docker-compose -y
```
**3. Docker Compose-Redis Ïã§Ìñâ** 
```bash
docker-compose up -d
docker ps
docker exec -it {Ïã§ÌñâÎêú Redis Ïª®ÌÖåÏù¥ÎÑàÏù¥Î¶Ñ} redis-cli
```
**4. ÌîÑÎ°úÏ†ùÌä∏ ÎπåÎìú Î∞è Ïã§Ìñâ**  
```bash
./gradlew build
./gradlew bootRun
```

---
### **API Î™ÖÏÑ∏ÏÑú**

**API Ïä§Ìéô**
```markdown
## API Î™ÖÏÑ∏ÏÑú

### 1. **ÏÉÅÌíà Ïû¨ÏûÖÍ≥† Î∞è ÏïåÎ¶º Ï†ÑÏÜ°**
- **URL**: `POST /products/{productId}/notifications/re-stock`

### 2. **Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ° API(manual)**
- **URL**: `POST /admin/products/{productId}/notifications/re-stock`
```

### **ÏÑ±Í≥µ ÏùëÎãµ ÏòàÏãú**
```json
{
    "message": "Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Ïã§Ìñâ ÎêòÏóàÏäµÎãàÎã§.",
    "code": 200,
    "data": {
        "productId": 1,
        "stock": 96,
        "restockRound": 3,
        "restockTime": "2024-12-16 16:24:48",
        "notificationHistoryId": 7,
        "status": "COMPLETED",
        "notificationStartTime": "2024-12-16 16:24:43",
        "notificationEndTime": "2024-12-16 16:24:43",
        "lastSentUserId": 1,
        "notifiedUsers": [
            {
                "userId": 1,
                "notificationSent": true
            }
        ]
    }
}

```
## **API ÏùëÎãµ ÌïÑÎìú ÏÉÅÏÑ∏ ÏÑ§Î™Ö**

| **ÌïÑÎìúÎ™Ö**         | **ÌÉÄÏûÖ**   | **ÏÑ§Î™Ö**                                           |
|------------------|------------|--------------------------------------------------|
| **message**       | `String`   | API Ìò∏Ï∂úÏóê ÎåÄÌïú ÏùëÎãµ Î©îÏãúÏßÄ                         | 
| **code**          | `Integer`  | HTTP ÏÉÅÌÉú ÏΩîÎìú (200 - OK)                         |
| **data**          | `Object`   | Ìò∏Ï∂ú Í≤∞Í≥ºÏóê ÎåÄÌïú Ïã§Ï†ú Îç∞Ïù¥ÌÑ∞                      |
| **productId**     | `Long`     | Ïû¨ÏûÖÍ≥†Í∞Ä Î∞úÏÉùÌïú ÏÉÅÌíàÏùò ID                          |
| **stock**         | `Integer`  | Ïû¨ÏûÖÍ≥† ÌõÑ ÎÇ®ÏïÑÏûàÎäî Ïû¨Í≥† ÏàòÎüâ                        |
| **restockRound**  | `Integer`  | Ïû¨ÏûÖÍ≥† ÌöåÏ∞® (Î™á Î≤àÏß∏ Ïû¨ÏûÖÍ≥†Ïù∏ÏßÄ)                    |
| **restockTime**   | `String`   | Ïû¨ÏûÖÍ≥†Í∞Ä Î∞úÏÉùÌïú ÏãúÍ∞Ñ (yyyy-MM-dd HH:mm:ss)          |
| **notificationHistoryId** | `Long` | Ïù¥Î≤à Ïû¨ÏûÖÍ≥† ÏïåÎ¶ºÍ≥º Í¥ÄÎ†®Îêú ÏïåÎ¶º ÌûàÏä§ÌÜ†Î¶¨ ID         |
| **status**        | `String`   | ÏïåÎ¶º ÏÉÅÌÉú (IN_PROGRESS, COMPLETED, CANCELED_BY_SOLD_OUT, CANCELED_BY_ERROR) |
| **notificationStartTime** | `String` | ÏïåÎ¶º Î∞úÏÜ°Ïù¥ ÏãúÏûëÎêú ÏãúÍ∞Ñ (yyyy-MM-dd HH:mm:ss)    |
| **notificationEndTime** | `String` | ÏïåÎ¶º Î∞úÏÜ°Ïù¥ Ï¢ÖÎ£åÎêú ÏãúÍ∞Ñ (yyyy-MM-dd HH:mm:ss)     |
| **lastSentUserId** | `Long`     | ÎßàÏßÄÎßâÏúºÎ°ú ÏïåÎ¶ºÏùÑ Ï†ÑÏÜ°Ìïú ÏÇ¨Ïö©Ïûê ID                 |
| **notifiedUsers**  | `Array`    | ÏïåÎ¶ºÏùÑ Î∞õÏùÄ Ïú†Ï†Ä Ï†ïÎ≥¥ Î∞∞Ïó¥                         |
| **userId**         | `Long`     | ÏïåÎ¶ºÏùÑ Î∞õÏùÄ Ïú†Ï†ÄÏùò ID                             
| **notificationSent** | `Boolean`| Ìï¥Îãπ Ïú†Ï†ÄÏóêÍ≤å ÏïåÎ¶ºÏù¥ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Î∞úÏÜ°ÎêòÏóàÎäîÏßÄ Ïó¨Î∂Ä  |

---
## **ERD Íµ¨Ï°∞ Î∞è ÏÉÅÏÑ∏ ÏÑ§Î™Ö**

Ïû¨ÏûÖÍ≥† ÏïåÎ¶º ÏãúÏä§ÌÖúÏùò ERD(Entity Relationship Diagram)Îäî ÏïÑÎûòÏôÄ Í∞ôÏùÄ ÌÖåÏù¥Î∏îÎ°ú Íµ¨ÏÑ±Îê©ÎãàÎã§.

- **Product**: ÏÉÅÌíà Ï†ïÎ≥¥Î•º Í¥ÄÎ¶¨ÌïòÎäî ÌÖåÏù¥Î∏î
- **ProductUserNotification**: Ïú†Ï†ÄÍ∞Ä ÌäπÏ†ï ÏÉÅÌíàÏóê ÎåÄÌï¥ ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌïú Ï†ïÎ≥¥Î•º Í¥ÄÎ¶¨ÌïòÎäî ÌÖåÏù¥Î∏î
- **ProductUserNotificationHistory**: Ïú†Ï†ÄÎ≥ÑÎ°ú ÏÉÅÌíàÏóê ÎåÄÌï¥ ÏïåÎ¶ºÏù¥ Ï†ÑÏÜ°Îêú Ïù¥Î†•ÏùÑ Í¥ÄÎ¶¨ÌïòÎäî ÌÖåÏù¥Î∏î
- **ProductNotificationHistory**: ÏÉÅÌíàÏùò Ïû¨ÏûÖÍ≥† Ïù¥Î†•ÏùÑ Í¥ÄÎ¶¨ÌïòÎäî ÌÖåÏù¥Î∏î

```sql
 Product ÌÖåÏù¥Î∏î ÏÉùÏÑ±
CREATE TABLE Product (
    id BIGINT AUTO_INCREMENT PRIMARY KEY, -- Í∏∞Î≥∏ ÌÇ§ (Primary Key)
    restock_round INT NOT NULL, -- Ïû¨ÏûÖÍ≥† ÎùºÏö¥Îìú (NOT NULL)
    stock INT NOT NULL, -- ÌòÑÏû¨ Ïû¨Í≥† (NOT NULL)
    previousStock INT, -- Ïù¥Ï†Ñ Ïû¨Í≥† (NULL ÌóàÏö©)
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- ÏÉùÏÑ± ÏãúÍ∞Ñ
    modifiedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP -- ÏàòÏ†ï ÏãúÍ∞Ñ
);
```
```sql
-- ProductUserNotification ÌÖåÏù¥Î∏î ÏÉùÏÑ± (User-Product Í¥ÄÍ≥Ñ ÌÖåÏù¥Î∏î)
CREATE TABLE ProductUserNotification (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modifiedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES User(id) ON DELETE CASCADE, -- user_id -> id
    FOREIGN KEY (product_id) REFERENCES Product(id) ON DELETE CASCADE -- product_id -> id
);
```
```sql
-- ProductUserNotificationHistory ÌÖåÏù¥Î∏î ÏÉùÏÑ± (ÏïåÎ¶º Ï†ÑÏÜ° Ïù¥Î†• ÌÖåÏù¥Î∏î)
CREATE TABLE ProductUserNotificationHistory (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    restock_round INT,
    sent_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modifiedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES User(id) ON DELETE CASCADE, -- user_id -> id
    FOREIGN KEY (product_id) REFERENCES Product(id) ON DELETE CASCADE -- product_id -> id
);
```
```sql
-- ProductNotificationHistory ÌÖåÏù¥Î∏î ÏÉùÏÑ± (Ïû¨Í≥† Î≥ÄÍ≤Ω Ïù¥Î†• ÌÖåÏù¥Î∏î)
CREATE TABLE ProductNotificationHistory (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    product_id BIGINT NOT NULL,
    last_sent_user_id BIGINT,
    restock_round INT,
    status VARCHAR(50),
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    modifiedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES Product(id) ON DELETE CASCADE, -- product_id -> id
    FOREIGN KEY (last_sent_user_id) REFERENCES User(id) ON DELETE SET NULL -- user_id -> id
);
```
## **ERD Í¥ÄÍ≥Ñ ÏÑ§Î™Ö**
- **Product** (ÏÉÅÌíà) - **ProductUserNotification** (ÏïåÎ¶º ÏÑ§Ï†ï)
  - Í¥ÄÍ≥Ñ: 1:N Í¥ÄÍ≥Ñ (Ìïú ÏÉÅÌíàÏóê Ïó¨Îü¨ Ïú†Ï†ÄÍ∞Ä ÏïåÎ¶ºÏùÑ ÏÑ§Ï†ïÌï† Ïàò ÏûàÏùå)
  - Ïó∞Í≤∞: Product.id ‚Üí ProductUserNotification.product_id

- **Product** (ÏÉÅÌíà) - **ProductUserNotificationHistory** (ÏïåÎ¶º Î∞úÏÜ° Ïù¥Î†•)
  - Í¥ÄÍ≥Ñ: 1:N Í¥ÄÍ≥Ñ (Ìïú ÏÉÅÌíàÏóê ÎåÄÌï¥ Ïó¨Îü¨ Ïú†Ï†ÄÏóêÍ≤å ÏïåÎ¶ºÏù¥ Î∞úÏÜ°Îê®)
  - Ïó∞Í≤∞: Product.id ‚Üí ProductUserNotificationHistory.product_id

- **Product** (ÏÉÅÌíà) - **ProductNotificationHistory** (Ïû¨ÏûÖÍ≥† Ïù¥Î†•)
  - Í¥ÄÍ≥Ñ: 1:N Í¥ÄÍ≥Ñ (ÌïòÎÇòÏùò ÏÉÅÌíàÏùÄ Ïó¨Îü¨ Ïû¨ÏûÖÍ≥† Ïù¥Î†•ÏùÑ Í∞ÄÏßà Ïàò ÏûàÏùå)
  - Ïó∞Í≤∞: Product.id ‚Üí ProductNotificationHistory.product_id

- **User** (Ïú†Ï†Ä) - **ProductNotificationHistory** (ÏïåÎ¶º Ïù¥Î†•)
  - Í¥ÄÍ≥Ñ: 1:N Í¥ÄÍ≥Ñ (ÌïòÎÇòÏùò Ïú†Ï†ÄÍ∞Ä Ïó¨Îü¨ ÏïåÎ¶ºÏùÑ Î≥¥ÎÇº Ïàò ÏûàÏùå)
  - Ïó∞Í≤∞: User.id ‚Üí ProductNotificationHistory.last_sent_user_id

## **ERD Îã§Ïù¥Ïñ¥Í∑∏Îû®**
![image](https://github.com/user-attachments/assets/ceacfc4b-979f-45dc-8d66-a207182e9e18)

---
## **ÎèôÏûë ÌùêÎ¶ÑÎèÑ**

Îã§ÏùåÏùÄ Ïû¨ÏûÖÍ≥† ÏïåÎ¶º ÏãúÏä§ÌÖúÏùò **Ï†ÑÏ≤¥ ÎèôÏûë Í≥ºÏ†ï**Ïóê ÎåÄÌïú ÌùêÎ¶ÑÎèÑÏûÖÎãàÎã§.

1Ô∏è‚É£ **Ïä§ÏºÄÏ§ÑÎü¨**Í∞Ä 1Î∂ÑÎßàÎã§ Ïû¨ÏûÖÍ≥† Î∞úÏÉù Ïó¨Î∂ÄÎ•º ÌôïÏù∏Ìï©ÎãàÎã§.

2Ô∏è‚É£ Ïû¨ÏûÖÍ≥†Í∞Ä Î∞úÏÉùÌïú ÏÉÅÌíàÏóê ÎåÄÌï¥ **ÏïåÎ¶º Ï†ÑÏÜ°ÏùÑ ÏãúÏûë**Ìï©ÎãàÎã§.

3Ô∏è‚É£ ProductNotificationHistoryÏóê ÏïåÎ¶º ÏÉÅÌÉúÎ•º IN_PROGRESSÎ°ú Ï†ÄÏû•Ìï©ÎãàÎã§.

4Ô∏è‚É£ ProductUserNotification ÌÖåÏù¥Î∏îÏóê Îì±Î°ùÎêú Î™®Îì† Ïú†Ï†ÄÏóêÍ≤å ÏïåÎ¶ºÏùÑ Ï†ÑÏÜ°Ìï©ÎãàÎã§.

5Ô∏è‚É£ Ïû¨Í≥†Í∞Ä ÏÜåÏßÑÎêòÎ©¥ ÏïåÎ¶ºÏùÑ Ï§ëÎã®ÌïòÍ≥†, ÏÉÅÌÉúÎ•º **CANCELED_BY_SOLD_OUT**Î°ú ÏóÖÎç∞Ïù¥Ìä∏Ìï©ÎãàÎã§.

6Ô∏è‚É£ Î™®Îì† Ïú†Ï†ÄÏóêÍ≤å ÏïåÎ¶ºÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∞úÏÜ°ÎêòÎ©¥ ÏÉÅÌÉúÎ•º **COMPLETED**Î°ú ÏóÖÎç∞Ïù¥Ìä∏Ìï©ÎãàÎã§.

---
## **ÎèôÏûë ÏãúÏó∞**

### 1. **Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ° API ÏòàÏãú (Postman)**
<details>
  <summary>üñºÔ∏è Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ° API Î≥¥Í∏∞</summary>
  <br>
  <img src="https://github.com/user-attachments/assets/6488d9f6-c791-47c2-aeff-6512ce3e5f1d" alt="Ïû¨ÏûÖÍ≥† ÏïåÎ¶º API" style="max-width:100%;"/>
</details>

### 2. **Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ° API (manual) (Postman)**
<details>
  <summary>üñºÔ∏èÏû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ° API (manual) Î≥¥Í∏∞</summary>
  <br>
  <img src="https://github.com/user-attachments/assets/8ea3c6e8-4e4a-4dcd-b4c5-cdc6ca11369e" alt="Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Ï†ÑÏÜ° API (manual)" style="max-width:100%;"/>
</details>

---
## üìò **ÌÖåÏä§Ìä∏ ÏΩîÎìú ÏÉÅÏÑ∏ ÏÑ§Î™Ö**

### **üß™ RestockNotificationServiceIntegrationTest**

ÌÜµÌï© ÌÖåÏä§Ìä∏ ÌÅ¥ÎûòÏä§ **RestockNotificationServiceIntegrationTest**Îäî Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ÏôÄ ÏßÅÏ†ë ÏÉÅÌò∏ ÏûëÏö©ÌïòÎäî ÌÜµÌï© ÌÖåÏä§Ìä∏Î•º Ìè¨Ìï®Ìï©ÎãàÎã§. Ïù¥ ÌÖåÏä§Ìä∏Îäî Ïã§Ï†ú DBÏóê Ï†ëÍ∑ºÌïòÏó¨ ÎπÑÏ¶àÎãàÏä§ Î°úÏßÅÏùÑ Í≤ÄÏ¶ùÌïòÎäî Îç∞ ÏÇ¨Ïö©Îê©ÎãàÎã§.


### **üìã ÌÅ¥ÎûòÏä§ Ï†ïÎ≥¥**
- **ÌÖåÏä§Ìä∏ ÎåÄÏÉÅ**: `RestockNotificationService`
- **ÏÇ¨Ïö© Í∏∞Ïà†**: `@SpringBootTest`, `@Transactional`
- **Ï£ºÏöî Í∏∞Îä•**: Ïû¨ÏûÖÍ≥† Î°úÏßÅ, Ïû¨ÏûÖÍ≥† ÏïåÎ¶º Î∞úÏÜ°, ÏòàÏô∏ ÏÉÅÌô©ÏùÑ Ìè¨Ìï®Ìïú Ï†ÑÎ∞òÏ†ÅÏù∏ ÌÜµÌï© ÌÖåÏä§Ìä∏


### **üìå Ï£ºÏöî Î©îÏÑúÎìú**
| **Î©îÏÑúÎìúÎ™Ö**                      | **ÏÑ§Î™Ö**                                      |
|---------------------------------|---------------------------------------------|
| **setUp()**                     | Í∞Å ÌÖåÏä§Ìä∏ Ï†ÑÏóê Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† ÏÉÅÌíà Î∞è ÏÇ¨Ïö©Ïûê ÏïåÎ¶º Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÍ∞ÄÌï©ÎãàÎã§. |
| **restockProduct_Success()**    | Ïû¨ÏûÖÍ≥† ÏÑ±Í≥µ Ïãú Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÎèôÏûëÌïòÎäîÏßÄ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§. |
| **restockProduct_StopsWhenOutOfStock()** | Ïû¨ÏûÖÍ≥† Ï§ë Ïû¨Í≥† ÏÜåÏßÑ Ïãú ÏïåÎ¶ºÏù¥ Ï§ëÎã®ÎêòÎäîÏßÄ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§. |
| **retryNotification_Success()** | ÏïåÎ¶º Ïû¨Î∞úÏÜ°Ïù¥ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú ÎèôÏûëÌïòÎäîÏßÄ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§. |
| **findProductById_Fail_ProductNotFound()** | Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏÉÅÌíà Ï°∞Ìöå Ïãú ÏòàÏô∏Í∞Ä Î∞úÏÉùÌïòÎäîÏßÄ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§. |
| **retryNotification_Fail_NoNotificationHistory()** | ÏïåÎ¶º Ïù¥Î†•Ïù¥ ÏóÜÎäî Í≤ΩÏö∞ ÏòàÏô∏Í∞Ä Î∞úÏÉùÌïòÎäîÏßÄ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§. |

---

### **üìå ÌÜµÌï© ÌÖåÏä§Ìä∏ ÏΩîÎìú ÏÑ§Î™Ö**

#### 1Ô∏è‚É£ **setUp() - Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî**
- ÌÖåÏä§Ìä∏ Ïã§Ìñâ Ï†Ñ **@BeforeEach** Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖòÏùÑ ÌÜµÌï¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º Ï¥àÍ∏∞ÌôîÌï©ÎãàÎã§.
- ÏÉÅÌíà, ÏÇ¨Ïö©Ïûê ÏïåÎ¶º, ÏïåÎ¶º Ïù¥Î†•Í≥º Í∞ôÏùÄ Îç∞Ïù¥ÌÑ∞Î•º ÎØ∏Î¶¨ ÏÉùÏÑ±ÌïòÏó¨ Í∞Å ÌÖåÏä§Ìä∏ Î©îÏÑúÎìúÏóê ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù Ï§ÄÎπÑÌï©ÎãàÎã§.
```java
@BeforeEach
void setUp() {
    productUserNotificationHistoryRepository.deleteAll();
    productNotificationHistoryRepository.deleteAll();
    productUserNotificationRepository.deleteAll();
    productRepository.deleteAll();

    product = Product.builder()
            .stock(1) // Ïû¨Í≥† 1Î°ú ÏÑ§Ï†ï
            .previousStock(5)
            .restockRound(1)
            .build();
    productRepository.save(product);

    ProductUserNotification user1 = ProductUserNotification.builder()
            .product(product)
            .userId(101L)
            .isActive(true)
            .build();

    ProductUserNotification user2 = ProductUserNotification.builder()
            .product(product)
            .userId(102L)
            .isActive(true)
            .build();

    productUserNotificationRepository.save(user1);
    productUserNotificationRepository.save(user2);
}


